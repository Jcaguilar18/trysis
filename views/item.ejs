<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Catalog</title>
    <%- include('sidebar') %>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./styles/item-catalog-page.css"/>
</head>

<body>

    <div class="web-page">
        <div class="top-bar">
            <img class="trisys-logo" src="./assets/trisys-logo.png"/>
            <p class="current-user-text">INVENTORY MANAGER</p>
            <img class="profile-picture" src="./assets/profile-picture.png"/>
          </div>
          <div class="bottom-page-part">
            <div class="upper-part">
                <img class="item-icon" src="./assets/group.png"/>
                <p class="item-catalog-text">Item Catalog </p>
                <% 
                var date = new Date();
                var options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                var formattedDate = date.toLocaleDateString('en-US', options);
                %>
              <p class="date-text"><%= formattedDate %></p>
              </div>
              <div class="middle-buttons-area">
                <button class="all-text" onclick="filterTable('')">All</button>
                <button class="fabrication-text-selection" onclick="filterTable(1)">Fabrication</button> <!-- Pass classification id as argument -->
                <button class="fire-protection-text-selection" onclick="filterTable(2)">Fire Protection</button> <!-- Pass classification id as argument -->
                <button class="electrical-text-selection" onclick="filterTable(3)">Electrical</button> <!-- Pass classification id as argument -->
                <div class="search-bar">
                  <!--TASK: Search Based on Code-->
                  <input class="search-input" type="text" placeholder="Search Code here..."/>
                  <img class="search-icon" src="./assets/searchicon-1.png"/>
                </div>
                <img class="on-off-switch-button" src="./assets/onoffswitch-1.png"/>
                <img class="atoz-icon" src="./assets/atoz.png"/>
              </div>
              <div class="tables-section">
                <div class="left-side-tables">
                  <div class="left-legend-area">
                    <div class="search-bar-left-legend">
                      <input class="search-input-legend" type="text" placeholder="Search Code here"/>
                      <img class="search-icon-legend" src="./assets/searchicon-1.png"/>
                    </div>
                    <p class="left-legend-text">Legend (Fabrication)</p>
                    <img class="pencil-icon-left-legend" src="./assets/pencil-icon-item.png"/>
                  </div>
                  <div class="tables-area-left">
                    <table id="itemTable" class="item-catalog-table">
                      <thead>
                        <tr>
                          <th>CODE</th>
                          <th>DESCRIPTION</th>
                          <th>ACTION</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% if (cluster1 && cluster1.length > 0) { %>
                          <% cluster1.forEach(cluster1 => { %>
                            <tr class="cluster-row" data-clustercode="<%= cluster1.clustercode %>" data-classificationid="<%= cluster1.classification_id %>">
                              <td><%= cluster1.clustercode %></td>
                              <td><%= cluster1.description %></td>
                              <td>
                                <!--TASK: Filter based on Classification Clicked-->
                                <button class="action-buttons" onclick="openModal('<%= cluster1.clustercode %>', '<%= cluster1.classification_id %>')" style="font-family: FontAwesome;"></button>
                                <!--TASK: Filter Items based on clustercode-->
                                <button class="action-buttons" onclick="documentFunction('<%= cluster1.clustercode %>', '<%= cluster1.description %>')" style="font-family: FontAwesome;"></button>
                              </td>
                            </tr>
                          <% }); %>
                        <% } else { %>
                          <tr>
                            <td colspan="4">No items found</td>
                          </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="right-side-tables">
                  <div class="upper-right">
                    <div class="right-legend-area">
                      <div class="search-bar-right-legend">
                        <input class="search-input-legend" type="text" placeholder="Search Code here"/>
                        <img class="search-icon-legend" src="./assets/searchicon-1.png"/>
                      </div>
                      <p class="right-legend-text">Legend (Fabrication)</p>
                      <img class="pencil-icon-right-legend" src="./assets/pencil-icon-item.png"/>
                    </div>
                    <div class="tables-area-upper-right">
                      <table id="itemTable" class="item-catalog-table">
                        <thead>
                          <tr>
                            <th>CODE</th>
                            <th>DESCRIPTION</th>
                            <th>ACTION</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% if (cluster2 && cluster2.length > 0) { %>
                            <% cluster2.forEach(cluster2 => { %>
                              <tr class="cluster-row" data-clustercode="<%= cluster2.clustercode %>" data-classificationid="<%= cluster2.classification_id %>">
                                <td><%= cluster2.clustercode %></td>
                                <td><%= cluster2.description %></td>
                                <td>
                                  <!--TASK: Filter based on Classification Clicked-->
                                  <button class="action-buttons" onclick="openModal('<%= cluster2.clustercode %>', '<%= cluster2.classification_id %>')" style="font-family: FontAwesome;"></button>
                                  <!--TASK: Filter Items based on clustercode-->
                                  <button class="action-buttons" onclick="documentFunction('<%= cluster2.clustercode %>', '<%= cluster2.description %>')" style="font-family: FontAwesome;"></button>
                                </td>
                              </tr>
                            <% }); %>
                          <% } else { %>
                            <tr>
                              <td colspan="4">No items found</td>
                            </tr>
                          <% } %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="lower-right">
                    <div class="right-legend-area">
                      <div class="search-bar-right-legend">
                        <input class="search-input-legend" type="text" placeholder="Search Code here"/>
                        <img class="search-icon-legend" src="./assets/searchicon-1.png"/>
                      </div>
                      <p class="right-legend-text">Legend (Fabrication)</p>
                      <img class="pencil-icon-right-legend" src="./assets/pencil-icon-item.png"/>
                    </div>
                    <div class="tables-area-lower-right">
                      <table id="itemTable" class="item-catalog-table">
                        <thead>
                          <tr>
                            <th>CODE</th>
                            <th>DESCRIPTION</th>
                            <th>ACTION</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% if (cluster3 && cluster3.length > 0) { %>
                            <% cluster3.forEach(cluster3 => { %>
                              <tr class="cluster-row" data-clustercode="<%= cluster3.clustercode %>" data-classificationid="<%= cluster3.classification_id %>">
                                <td><%= cluster3.clustercode %></td>
                                <td><%= cluster3.description %></td>
                                <td>
                                  <!--TASK: Filter based on Classification Clicked-->
                                  <button class="action-buttons" onclick="openModal('<%= cluster3.clustercode %>', '<%= cluster3.classification_id %>')" style="font-family: FontAwesome;"></button>
                                  <!--TASK: Filter Items based on clustercode-->
                                  <button class="action-buttons" onclick="documentFunction('<%= cluster3.clustercode %>', '<%= cluster3.description %>')" style="font-family: FontAwesome;"></button>
                                </td>
                              </tr>
                            <% }); %>
                          <% } else { %>
                            <tr>
                              <td colspan="4">No items found</td>
                            </tr>
                          <% } %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              <table id="itemTable2" class="item-catalog-table2">
                <thead>
                  <tr>
                    <th>CODE</th>
                    <th>DESCRIPTION</th>
                    <th>ACTION</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (cluster && cluster.length > 0) { %>
                    <% cluster.forEach(cluster => { %>
                      <tr class="cluster-row" data-clustercode="<%= cluster.clustercode %>" data-classificationid="<%= cluster.classification_id %>">
                        <td><%= cluster.clustercode %></td>
                        <td><%= cluster.description %></td>
                        <td>
                          <!--TASK: Filter based on Classification Clicked-->
                          <button class="action-buttons" onclick="openModal('<%= cluster.clustercode %>', '<%= cluster.classification_id %>')" style="font-family: FontAwesome;"></button>
                          <!--TASK: Filter Items based on clustercode-->
                          <button class="action-buttons" onclick="documentFunction('<%= cluster.clustercode %>', '<%= cluster.description %>')" style="font-family: FontAwesome;"></button>
                        </td>
                      </tr>
                    <% }); %>
                  <% } else { %>
                    <tr>
                      <td colspan="4">No items found</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
          </div>
    </div>

<!---------------------------------------------------------------------------------------------->
                              <!-- Modals -->
<!---------------------------------------------------------------------------------------------->

<!-- openModal() -->
<div id="myModal" class="modal">
<div class="modal-content">
    <span class="close">×</span>
    <div class="add-cluster-section">
        <div class="title-section-modal">
            <img class="pencil-icon" src="./assets/pencilicon-1.png"/>
            <p class="edit-cluster-text">Edit Cluster Information</p>
        </div>
        <div class="table-section">
            <div class="header">
                <p class="code-text">CODE</p>
                <p class="description-text">DESCRIPTION</p>
            </div>
            <% if (cluster && cluster.length > 0) { %>
                <% cluster.forEach(cluster => { %>
                    <div class="entry">
                        <!--TASK: Save Changes Once Changed, Handle When Left Blank-->
                        <div class="code" contenteditable="true"><%= cluster.clustercode %></div>
                        <div class="description" contenteditable="true"><%= cluster.description %></div>
                        <img class="gear" src="./assets/changinggear-1.png"/>
                    </div>
                <% }); %>
            <% } else { %>
                <div>No items found</div>
            <% } %>
        </div>
        <div class="add-section">
          <button class="add-button">
            <img class="add-cluster-icon" src="./assets/additionicon-1.png" onclick="window.location.href='/add-cluster'" />
          </button>
      </div>
        <div class="lower-section">
            <button onclick="discardChanges()" class="discard-button">Discard</button>
            <button onclick="saveChanges()" class="save-button">Save</button>
            <!--- <button onclick="additemFunction('<%= cluster.clustercode %>')" class="add-item-button">Add Item</button> -->
        </div>
    </div>
</div>  
</div>

<!-- documentFunction() -->
<div id="myModal2" class="modal">
  <div class="modal-content2">
    <!-- <span class="close">×</span> -->
    <div class="upper-section-modal">
      <button class="back-button" onclick="modal2.style.display = 'none';">&lt;Back</button>
    </div>
    <div class="upper-table-part">
      <p class="upper-table-part-text">Code:</p>
      <!--TASK: Sort by Code-->
      <input type="text" id="code" name="code" placeholder="Search code..."> 
      <p class="upper-table-part-text">Material:</p> 
      <!--TASK: Sort by Material Name-->
      <input type="text" id="material" name="material" placeholder="Search material..."> 
    </div>
    <div class="below-upper-table-part">
      <button id="addItem" class="below-table-part-text">+ Add Item</button> 
      <p class="below-table-part-text">ITEM DESCRIPTION</p>
      <p class="below-table-part-text">ACTION</p>
      <p class="below-table-part-text">AVAILABLE</p>
      <p class="below-table-part-text">PRICE</p>
      <p class="below-table-part-text">TOTAL AMOUNT</p>
    </div>
<div class="modal-table-part">
  <div class="inventory-table">
    <% if (item && item.length > 0) { %>
      <% item.forEach(item => { %>
        <div class="table-row">
          <div class="table-cell"><%= item.clustercode %></div>
          <div class="table-cell"><%= item.material_name %></div>
          <div class="table-cell">
            <!--TASK: Create Edit Item Function (Total Amount is Note Editable)-->
            <button onclick="editItem('<%= item.id %>')"><img src="./assets/edit_icon_pencil.png" alt="Edit"></button>
            <!--TASK: Create Delete Item Function-->
            <button onclick="deleteItem('<%= item.id %>')"><img src="./assets/trash_icon.png" alt="Delete"></button>
          </div>
          <div class="table-cell"><%= item.available %></div>
          <div class="table-cell">₱<%= item.price %></div>
          <div class="table-cell">₱<%= item.price * item.available %></div>
        </div>
      <% }); %>
    <% } else { %>
      <div>No items found</div>
    <% } %>
  </div>
</div>
    <div class="pagination-table-part">
      <!--TASK: Create Pagination Area Function (Refer to the Mockup) [Navigation + Showing Number of Pager Currently] -->
    </div>
  </div>  
</div>


<!---------------------------------------------------------------------------------------------->
                            <!--Script Area -->
<!---------------------------------------------------------------------------------------------->


<script>
  
  
// Filter the table based on classification id
function filterTable(id) {
    // Remove the active class from all buttons
    $('.middle-buttons-area button').removeClass('active');

    // Add the active class to the clicked button
    if (id === '') {
        $('.all-text').addClass('active');
        $('.tables-section').show(); // Show the tables-section when "All" is clicked
        $('#itemTable2').hide(); // Hide the last table when "All" is clicked
    } else {
        if (id === 1 || id === 2 || id === 3) {
            $('.tables-section').hide(); // Hide the tables-section when "Fabrication", "Electrical", or "Firepro" is clicked
            $('#itemTable2').show(); // Show the last table when "Fabrication", "Electrical", or "Firepro" is clicked
        }
        if (id === 1) {
            $('.fabrication-text-selection').addClass('active');
        } else if (id === 2) {
            $('.fire-protection-text-selection').addClass('active');
        } else if (id === 3) {
            $('.electrical-text-selection').addClass('active');
        }

        // Filter the table rows
        $('#itemTable2 tbody tr').each(function() {
            var rowId = $(this).attr('class');
            if (id.toString() === rowId || id === $(this).data('classificationid')) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    }
}

// Get the modal
var modal = document.getElementById("myModal");
var modal2 = document.getElementById("myModal2");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
var span2 = document.getElementsByClassName("close")[1];

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
modal.style.display = "none";
}

span2.onclick = function() {
modal2.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
if (event.target == modal) {
    modal.style.display = "none";
}
if (event.target == modal2) {
    modal2.style.display = "none";
}
}

// Function to open the modal and filter items based on the classification_id
function openModal(classification_id) {
    // Filter the items based on the classification_id
    var items = $('#myModal .entry').filter(function() {
        return $(this).data('classification_id') === classification_id;
    });

    // Hide all items
    $('#myModal .entry').hide();

    // Show only the items with the same classification_id
    items.show();

    // Show the modal
    modal.style.display = "block";
}

window.onclick = function(event) {
if (event.target == modal) {
    modal.style.display = "none";
}
if (event.target == modal2) {
    modal2.style.display = "none";
}
}

function documentFunction(clustercode, cluster_description) {
    // Filter the items based on the clustercode
    var items = $('.modal-table-part .table-row').filter(function() {
        return $(this).find('.table-cell:first-child').text().trim() === clustercode;
    });

    // Hide all items
    $('.modal-table-part .table-row').hide();

    // Initialize a counter
    var counter = 0;

    // Show only the items with the same clustercode and update their first cell with the counter
    items.each(function(index) {
        $(this).show();
        $(this).find('.table-cell:first-child').text(++counter);

        // Apply the colors dynamically
        if (index % 2 === 0) {
            $(this).find('.table-cell').css('background-color', '#E1E1E1'); // odd rows
        } else {
            $(this).find('.table-cell').css('background-color', 'white'); // even rows
        }
    });

    // Set the values of the input fields
    $('#code').val(clustercode);
    $('#material').val(cluster_description);

    // Make the input fields read-only
    $('#code').prop('readonly', true);
    $('#material').prop('readonly', true);

    // Show the modal
    modal2.style.display = "block";
}

// Functions to handle the discard and save buttons
function discardChanges() {
// Add your code here to discard changes
}

function saveChanges() {
// Add your code here to save changes
}

    </script>

</body>
</html>