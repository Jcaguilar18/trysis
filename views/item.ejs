<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Catalog</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./styles/item-catalog-page.css"/>
</head>

<body>

    <div class="web-page">
      <div class="top-bar">
        <img class="trisys-logo" src="./assets/trisys-logo-XA5.png"/>
        <div class="user-info">
            <p class="current-user-text"><%= roleOf %></p>
            <img class="profile-picture" src="<%= pictureUrl %>"/>
        </div>
     </div>
          <div class="bottom-page-part">
            <%- include('sidebar') %>
            <div class="upper-part">
                <img class="item-icon" src="./assets/group.png"/>
                <p class="item-catalog-text">Item Catalog </p>
                <% 
                var date = new Date();
                var options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                var formattedDate = date.toLocaleDateString('en-US', options);
                %>
              <p class="date-text"><%= formattedDate %></p>
              </div>
              <div class="middle-buttons-area">
                <button class="all-text" onclick="filterTable('')">All</button>
                <button class="fabrication-text-selection" onclick="filterTable(1)">Fabrication</button> <!-- Pass classification id as argument -->
                <button class="fire-protection-text-selection" onclick="filterTable(2)">Fire Protection</button> <!-- Pass classification id as argument -->
                <button class="electrical-text-selection" onclick="filterTable(3)">Electrical</button> <!-- Pass classification id as argument -->
                <div class="search-bar">
                  <input class="search-input-legend" type="text" id="myInput4" onkeyup="myFunction4()" placeholder="Search Code here...."/>
                  <img class="search-icon" src="./assets/searchicon-1.png"/>
                </div>
              </div>
              <div class="tables-section">
                <div class="left-side-tables">
                  <div class="left-legend-area">
                    <div class="search-bar-left-legend">
                      <input class="search-input-legend" type="text" id="myInput" onkeyup="myFunction()" placeholder="Search Code here"/>
                      <img class="search-icon-legend" src="./assets/searchicon-1.png"/>
                    </div>
                    <p class="left-legend-text">Legend (Fabrication)</p>
                    <% if (roleOf === "manager") { %>
                    <img class="pencil-icon-left-legend" src="./assets/pencil-icon-item.png" onclick="openModal('1')"/>
                    <% } %>
                  </div>
                  <div class="tables-area-left" style="position: relative;">
                    <table id="itemTable" class="item-catalog-table">
                      <thead style="position: sticky; top: 0; background-color: white;">
                        <tr>
                          <th>CODE</th>
                          <th>DESCRIPTION</th>
                          <th>ACTION</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% if (cluster1 && cluster1.length > 0) { %>
                          <% cluster1.forEach(cluster1 => { %>
                            <tr class="cluster-row" data-clustercode="<%= cluster1.clustercode %>" data-classificationid="<%= cluster1.classification_id %>">
                              <td><%= cluster1.clustercode %></td>
                              <td><%= cluster1.description %></td>
                              <td>
                                <% if (roleOf === "manager") { %>
                                <button class="action-buttons" onclick="editItemModal('<%= cluster1.clustercode %>', '<%= cluster1.description %>')" style="font-family: FontAwesome;"></button>
                                <% } %>
                                <button class="action-buttons" onclick="binCardModalFunction('<%= cluster1.clustercode %>', '<%= cluster1.description %>')" style="font-family: FontAwesome;"></button>
                              </td>
                            </tr>
                          <% }); %>
                        <% } else { %>
                          <tr>
                            <td colspan="4">No items found</td>
                          </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="right-side-tables">
                  <div class="upper-right">
                    <div class="right-legend-area">
                      <div class="search-bar-right-legend">
                        <input class="search-input-legend" type="text" id="myInput2" onkeyup="myFunction2()" placeholder="Search Code here"/>
                        <img class="search-icon-legend" src="./assets/searchicon-1.png"/>
                      </div>
                      <p class="right-legend-text">Legend (Firepro)</p>
                      <% if (roleOf === "manager") { %>
                      <img class="pencil-icon-right-legend" src="./assets/pencil-icon-item.png" onclick="openModal('2')"/>
                      <% } %>
                    </div>
                    <div class="tables-area-upper-right" style="position: relative;">
                      <table id="itemTable3" class="item-catalog-table">
                        <thead style="position: sticky; top: 0; background-color: white;">
                          <tr>
                            <th>CODE</th>
                            <th>DESCRIPTION</th>
                            <th>ACTION</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% if (cluster2 && cluster2.length > 0) { %>
                            <% cluster2.forEach(cluster2 => { %>
                              <tr class="cluster-row" data-clustercode="<%= cluster2.clustercode %>" data-classificationid="<%= cluster2.classification_id %>">
                                <td><%= cluster2.clustercode %></td>
                                <td><%= cluster2.description %></td>
                                <td>
                                  <!--TASK: Filter based on Classification Clicked-->
                                  <% if (roleOf === "manager") { %>
                                  <button class="action-buttons" onclick="editItemModal('<%= cluster2.clustercode %>', '<%= cluster2.description %>')" style="font-family: FontAwesome;"></button>
                                  <% } %>
                                  <button class="action-buttons" onclick="binCardModalFunction('<%= cluster2.clustercode %>', '<%= cluster2.description %>')" style="font-family: FontAwesome;"></button>
                                </td>
                              </tr>
                            <% }); %>
                          <% } else { %>
                            <tr>
                              <td colspan="4">No items found</td>
                            </tr>
                          <% } %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="lower-right">
                    <div class="right-legend-area">
                      <div class="search-bar-right-legend">
                        <input class="search-input-legend" type="text" id="myInput3" onkeyup="myFunction3()" placeholder="Search Code here"/>
                        <img class="search-icon-legend" src="./assets/searchicon-1.png"/>
                      </div>
                      <p class="right-legend-text">Legend (Electrical)</p>
                      <% if (roleOf === "manager") { %>
                      <img class="pencil-icon-right-legend" src="./assets/pencil-icon-item.png" onclick="openModal('3')"/>
                      <% } %>
                    </div>
                    <div class="tables-area-lower-right" style="position: relative;">
                      <table id="itemTable4" class="item-catalog-table">
                        <thead style="position: sticky; top: 0; background-color: white;">
                          <tr>
                            <th>CODE</th>
                            <th>DESCRIPTION</th>
                            <th>ACTION</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% if (cluster3 && cluster3.length > 0) { %>
                            <% cluster3.forEach(cluster3 => { %>
                              <tr class="cluster-row" data-clustercode="<%= cluster3.clustercode %>" data-classificationid="<%= cluster3.classification_id %>">
                                <td><%= cluster3.clustercode %></td>
                                <td><%= cluster3.description %></td>
                                <td>
                                  <% if (roleOf === "manager") { %>
                                  <button class="action-buttons" onclick="editItemModal('<%= cluster3.clustercode %>', '<%= cluster3.description %>')" style="font-family: FontAwesome;"></button>
                                  <% } %>
                                  <button class="action-buttons" onclick="binCardModalFunction('<%= cluster3.clustercode %>', '<%= cluster3.description %>')" style="font-family: FontAwesome;"></button>
                                </td>
                              </tr>
                            <% }); %>
                          <% } else { %>
                            <tr>
                              <td colspan="4">No items found</td>
                            </tr>
                          <% } %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              <div class="table-container" style="position: relative;">
              <table id="itemTable2" class="item-catalog-table2">
                <thead style="position: sticky; top: 0; background-color: white;">
                  <tr>
                    <th>CODE</th>
                    <th>DESCRIPTION</th>
                    <th>ACTION</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (cluster && cluster.length > 0) { %>
                    <% cluster.forEach(cluster => { %>
                      <tr class="cluster-row" data-clustercode="<%= cluster.clustercode %>" data-classificationid="<%= cluster.classification_id %>">
                        <td><%= cluster.clustercode %></td>
                        <td><%= cluster.description %></td>
                        <td>
                          <% if (roleOf === "manager") { %>
                          <button class="action-buttons" onclick="editItemModal('<%= cluster.clustercode %>', '<%= cluster.description %>')" style="font-family: FontAwesome;"></button>
                          <% } %>
                          <button class="action-buttons" onclick="binCardModalFunction('<%= cluster.clustercode %>', '<%= cluster.description %>')" style="font-family: FontAwesome;"></button>
                        </td>
                      </tr>
                    <% }); %>
                  <% } else { %>
                    <tr>
                      <td colspan="4">No items found</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
    </div>

<!---------------------------------------------------------------------------------------------->
                              <!-- Modals -->
<!---------------------------------------------------------------------------------------------->

<!-- openModal() -->
<div id="myModal" class="modal">
<div class="modal-content">
    <span class="close">×</span>
    <div class="add-cluster-section">
        <div class="title-section-modal">
            <img class="pencil-icon" src="./assets/pencilicon-1.png"/>
            <p class="edit-cluster-text">Edit Cluster Information</p>
        </div>
        <div class="table-section">
            <div class="header">
                <p class="code-text">CODE</p>
                <p class="description-text">DESCRIPTION</p>
            </div>
            <% if (cluster4 && cluster4.length > 0) { %>
                <% cluster4.forEach(cluster => { %>
                  <form action="/update-cluster" method="POST" class="table">
                    <div class="entry">
                      <!--TASK: Save Changes Once Changed, Handle When Left Blank-->
                      <div class="classification_hidden" id="cluster_cell" contenteditable="true"><%= cluster.classification_id %></div>
                      <input type="text" class="code" name="code" id="cluster_cell" value="<%= cluster.clustercode %>" style="text-align: center;">
                      <input type="text" class="description" name="description" id="cluster_cell" value="<%= cluster.description %>">
                      <img class="gear" id="cluster_cell" src="<%= cluster.status === 'SET' ? './assets/changinggear-1.png' : './assets/deset_icon.png' %>"/>
                      <select class="status-dropdown" name="status" id="status_dropdown" onchange="updateIcon(this.value)">
                        <option value="SET" <%= cluster.status === 'SET' ? 'selected' : '' %>>SET</option>
                        <option value="DESET" <%= cluster.status === 'DESET' ? 'selected' : '' %>>DESET</option>
                      </select>
                      <button type="submit" class="save-button">Save</button>
                    </div>
                  </form>
                <% }); %>
            <% } else { %>
                <div>No items found</div>
            <% } %>
        </div>
        <div class="add-section">
          <form action="/add-cluster" method="GET">
            <input type="hidden" name="classificationId" value="0"> <!-- Initialized with 0, but will be updated by JS -->
            <button type="button" class="add-button" onclick="openAddClusterModal(); myModal.style.display = 'none';">
              <img class="add-cluster-icon" src="./assets/additionicon-1.png" alt="Add Cluster"/>
            </button>
          </form>
        </div>
        
        <div class="lower-section">
            <!-- <button onclick="discardChanges()" class="discard-button">Discard</button> -->
            <!-- <button onclick="saveChanges()" class="save-button">Save</button> -->
            <!-- <button onclick="window.open('/update-cluster', '_blank')" class="save-button">Update</button> -->
            <!--- <button onclick="additemFunction('<%= cluster.clustercode %>')" class="add-item-button">Add Item</button> -->
        </div>
    </div>
</div>  
</div>

<div id="addClusterModal" class="modal">
  <div class="modal-content2-database">
    <div class="upper-section-modal-database">
      <button type="button" class="back-button" onclick="addClusterModal.style.display = 'none';">&lt;Back</button>
    </div>
    <form action="/add-cluster" method="POST" class="modal-form">
      <h1>Add Cluster</h1>
      <div class="form-group">
        <label for="clustercode" class="modal-form-text">Cluster Code:</label>
        <input type="text" class="form-control" id="clustercode" name="clustercode" required>
      </div>
      <div class="form-group">
        <label for="description" class="modal-form-text">Description:</label>
        <input type="text" class="form-control" id="description" name="description" required>
      </div>
      <input type="hidden" id="classificationid" name="classificationid">
      <button type="submit" class="modal-form-button">Add Material</button>
    </form>
  </div>
</div>

<div id="addItemModal" class="modal">
  <div class="modal-content2-database">
    <div class="upper-section-modal-database">
      <button type="button" class="back-button" onclick="addItemModal.style.display = 'none';">&lt;Back</button>
    </div>
    <form action="/add-item" method="POST" class="modal-form">
      <h1>Add Item</h1>
      <div class="form-group">
        <label for="materialName" class="modal-form-text">Material Name:</label>
        <input type="text" class="form-control" id="materialName" name="materialName" required>
      </div>
      <div class="form-group">
        <label for="price" class="modal-form-text">Price:</label>
        <input type="text" class="form-control" id="price" name="price" required>
      </div>
      <input type="hidden" id="clustercodeAddItem"  name="clustercode" value="VV">
      <button type="submit" class="modal-form-button">Add Item</button>
    </form>
  </div>
</div>

<div id="updateItemModal" class="modal">
  <div class="modal-content2-database">
    <div class="upper-section-modal-database">
      <button type="button" class="back-button" onclick="addItemModal.style.display = 'none';">&lt;Back</button>
    </div>
    <form action="/update-item" method="POST" class="modal-form">
      <h1>Update Item</h1>
      <div class="form-group">
        <label for="materialName" class="modal-form-text">New Material Name:</label>
        <input type="text" class="form-control" id="materialName" name="materialName" required>
      </div>
      <div class="form-group">
        <label for="price" class="modal-form-text">New Price:</label>
        <input type="text" class="form-control" id="price" name="price" required>
      </div>
      <input type="hidden" name="itemId" id="itemIDUpdate">
      <button type="submit" class="modal-form-button">Update Item</button>
    </form>
  </div>
</div>

<!-- editItemModal() -->
<div id="myModal2" class="modal">
  <!-- <form id="addItemForm" action="/add-item" method="GET"> -->
  <input type="hidden" id="code2" name="clustercode">
  <input type="hidden" id="material2" name="cluster_description">
  <div class="modal-content2">
    <!-- <span class="close">×</span> -->
    <div class="upper-section-modal">
      <button type="button" class="back-button" onclick="myModal2.style.display = 'none';">&lt;Back</button>
    </div>
    <div class="upper-table-part">
      <p class="upper-table-part-text">Code:</p>
      <!--TASK: Sort by Code-->
      <input type="text" id="code4" name="code" placeholder="Search code..." readonly> 
      <p class="upper-table-part-text">Material:</p> 
      <!--TASK: Sort by Material Name-->
      <input type="text" id="material4" name="material" placeholder="Search material..." readonly> 
    </div>
    <div class="below-upper-table-part">
      <button id="addItem" class="below-table-part-text" onclick="openAddItemModal(); myModal2.style.display = 'none';">+ Add Item</button>
    <!-- </form> -->
      <p class="below-table-part-text">ITEM DESCRIPTION</p>
      <p class="below-table-part-text">ACTION</p>
      <p class="below-table-part-text">AVAILABLE</p>
      <p class="below-table-part-text">PRICE</p>
      <p class="below-table-part-text">TOTAL AMOUNT</p>
    </div>
<div class="modal-table-part">
  <div class="inventory-table">
    <% if (item && item.length > 0) { %>
      <% item.forEach(item => { %>
        <div class="table-row">
          <div class="table-cell"><%= item.clustercode %></div>
          <div class="table-cell"><%= item.item_description %></div>
          <div class="table-cell">
           <!-- <form action="/update-item" method="GET"> -->
              <input type="hidden" name="item_id" value="<%= item.item_id %>">
              <button onclick="openUpdateItemModal('<%= item.item_id %>'); myModal2.style.display = 'none';" style="border: none; background: none; padding: 0;">
                  <img src="./assets/edit_icon_pencil.png" alt="Edit">
              </button>
              <button onclick="deleteItem(<%= item.item_id %>, this, event)">
                <i class="fa fa-trash"></i>
              </button>
          <!-- </form> -->
              <!-- <button onclick="deleteItem('<%= item.item_id %>', this)">
              <img src="./assets/trash_icon.png" alt="Delete">
          </button> -->

          
          </div>
          <div class="table-cell"><%= item.available %></div>
          <div class="table-cell">₱<%= item.price %></div>
          <div class="table-cell">₱<%= (item.price * item.available).toFixed(2) %></div>
        </div>
      <% }); %>
    <% } else { %>
      <div>No items found</div>
    <% } %>
  </div>
</div>
    <div class="pagination-table-part">
      <!--TASK: Create Pagination Area Function (Refer to the Mockup) [Navigation + Showing Number of Pager Currently] -->
    </div>
  </div>  
</div>

<!-- Inventory BIN Card Modal -->
<div id="binCardModalArea" class="modal">
  <div class="modal-content2">
    <div class="upper-section-modal">
      <button class="back-button" onclick="binCardModal.style.display = 'none';">&lt;Back</button>
    </div>
    <div class="upper-table-part">
      <p class="upper-table-part-text">Name of Material:</p>
      <input type="text" id="material3" name="material3" placeholder="Material ID"> 
      <p class="upper-table-part-text">Code:</p>
      <input type="text" id="code3" name="code3" placeholder="Code ID"> 
    </div>
    <div class="below-upper-table-part">
        <p class="below-table-part-text">ITEM DESCRIPTION</p>
        <p class="below-table-part-text">BEGINNING INVENTORY</p>
        <p class="below-table-part-text">TOTAL INCOMING</p>
        <p class="below-table-part-text">TOTAL-OUTGOING</p>
        <p class="below-table-part-text">AVAILABLE</p>
        <p class="below-table-part-text">UNIT PRICE</p>
    </div>
    <div class="modal-table-part">
      <div class="inventory-table">
        <% let totalAmount = 0; %>
        <% if (item && item.length > 0) { %>
          <% item.forEach(item => { %>
            <div class="table-row">
              <div class="table-cell2" style="display: none;"><%= item.clustercode %></div>
              <div class="table-cell2"><%= item.item_description %></div>
              <div class="table-cell2"><%= item.beginning_inventory %></div>
              <div class="table-cell2"><%= item.total_incoming %></div>
              <div class="table-cell2"><%= item.total_outgoing %></div>
              <div class="table-cell2"><%= item.available %></div>
              <div class="table-cell2">₱ <%= item.price %></div>
            </div>
          <% }); %>
        <% } else { %>
          <div>No items found</div>
        <% } %>
      </div>
    </div>
  </div>  
</div>

<!---------------------------------------------------------------------------------------------->
                            <!--Script Area -->
<!---------------------------------------------------------------------------------------------->


<script>
    // Example function that sets the hidden input field's value
    function setClustercodeForAddingItem(clustercode) {
    document.getElementById('addFormClustercode').value = clustercode;
}

function deleteItem(itemId, buttonElement, event) {
    // Prevent form submission
    event.preventDefault();

    if (confirm('Are you sure you want to delete this item?')) {
        $.ajax({
            type: 'POST',
            url: '/delete-item',
            data: { item_id: itemId },
            success: function(response) {
                // Remove the row from the table
                $(buttonElement).closest('tr').remove();
                alert('Item deleted successfully.');
                // Optionally, reload the page or part of it to reflect the changes
                location.reload();
            },
            error: function(xhr, status, error) {
                alert('Error deleting item: ' + xhr.responseText);
            }
        });
    }
    // Important: Stop the event from propagating and prevent default action
    return false;
}


function populateForm(clustercode, description, classificationid) {
    document.getElementById('clustercode').value = clustercode;
    document.getElementById('description').value = description;
    document.getElementById('classificationid').value = classificationid;
}
  
// Filter the table based on classification id
function filterTable(id) {
    // Remove the active class from all buttons
    $('.middle-buttons-area button').removeClass('active');

    // Add the active class to the clicked button
    if (id === '') {
        $('.all-text').addClass('active');
        $('.tables-section').show(); // Show the tables-section when "All" is clicked
        $('#itemTable2').hide(); // Hide the last table when "All" is clicked
    } else {
        if (id === 1 || id === 2 || id === 3) {
            $('.tables-section').hide(); // Hide the tables-section when "Fabrication", "Electrical", or "Firepro" is clicked
            $('#itemTable2').show(); // Show the last table when "Fabrication", "Electrical", or "Firepro" is clicked
        }
        if (id === 1) {
            $('.fabrication-text-selection').addClass('active');
        } else if (id === 2) {
            $('.fire-protection-text-selection').addClass('active');
        } else if (id === 3) {
            $('.electrical-text-selection').addClass('active');
        }

        // Filter the table rows
        $('#itemTable2 tbody tr').each(function() {
            var rowId = $(this).attr('class');
            if (id.toString() === rowId || id === $(this).data('classificationid')) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    }
}

// var globalClassificationId = 0;
// document.getElementById('classificationid').value = classification_id;


// Get the modal
var modal = document.getElementById("myModal");
var modal2 = document.getElementById("myModal2");
var binCardModal = document.getElementById("binCardModalArea");
var addClusterModal = document.getElementById('addClusterModal');
var addItemModal = document.getElementById('addItemModal');
var updateItemModal = document.getElementById('updateItemModal');

// Get the <span> element that closes the modal
var span = modal.querySelector(".close");
var span2 = modal2.querySelector(".close");
var binCardSpan = binCardModal.querySelector(".close");
var addClusterSpan = addClusterModal.querySelector(".close");
var addItemSpan = addItemModal.querySelector(".close");

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
modal.style.display = "none";
}

span2.onclick = function() {
modal2.style.display = "none";
}

binCardSpan.onclick = function() {
binCardModal.style.display = "none";
}

addClusterSpan.onclick = function() {
  addClusterModal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  } else if (event.target == modal2) {
    modal2.style.display = "none";
  } else if (event.target == binCardModal) {
    binCardModal.style.display = "none";
  } else if (event.target == addClusterModal) {
    addClusterModal.style.display = "none";
  }
}

// Function to open the modal and filter items based on the clustercode
function openModal(classification_id) {
  /* console.log('Hello'); */
  globalClassificationId = classification_id;
  mamamo = classification_id; // Update mamamo with the classificationId
    document.querySelector('input[name="classificationId"]').value = mamamo;
// Filter the items based on the clustercode

/* var items = $('#myModal tbody tr').filter(function() {
    return $(this).data('clustercode') === clustercode;
}); */

var items = $('#myModal .entry').filter(function() {
  return $(this).find('#cluster_cell:first-child').text().trim() === classification_id; });

// Hide all items
// $('#myModal tbody tr').hide();
$('#myModal .entry').hide();

// Show only the items with the same clustercode
items.show();

// Show the modal
modal.style.display = "block";
}

function openAddClusterModal(classification_id) {
  var classification_id = globalClassificationId;
  mamamo2 = classification_id; // Update mamamo with the classificationId
  document.querySelector('input[name="classificationid"]').value = globalClassificationId;
  addClusterModal.style.display = "block";
}

function openAddItemModal() {
  var clustercodeForItem = globalClusterCode;
  console.log('globalClusterCode in OpenAddItemModal:', clustercodeForItem);
  document.getElementById('clustercodeAddItem').value = clustercodeForItem; // Anomaly
  console.log('Current clustercode is: ', document.getElementById('clustercodeAddItem').value);
  addItemModal.style.display = "block";
}

function openUpdateItemModal(itemid) {
  // var itemid = globalItemId;
  console.log('globalItemId in openUpdateItemModal:', itemid);
  document.getElementById('itemIDUpdate').value = itemid; // Anomaly
  // console.log('Current clustercode is: ', document.getElementById('clustercodeAddItem').value);
  updateItemModal.style.display = "block";
}

function editItemModal(clustercode, cluster_description) {
    // Filter the items based on the clustercode
    globalClusterCode = clustercode;
    console.log('globalClusterCode in editItemModal:', globalClusterCode);
    var items = $('.modal-table-part .table-row').filter(function() {
        return $(this).find('.table-cell:first-child').text().trim() === clustercode;
    });

    // Hide all items
    $('.modal-table-part .table-row').hide();

    // Initialize a counter
    // var counter = 0;

    // Show only the items with the same clustercode and update their first cell with the counter
    items.each(function(index) {
        $(this).show();
        // $(this).find('.table-cell:first-child').text(++counter);

        // Apply the colors dynamically
        if (index % 2 === 0) {
            $(this).find('.table-cell').css('background-color', '#E1E1E1'); // odd rows
        } else {
            $(this).find('.table-cell').css('background-color', 'white'); // even rows
        }
    });
    

    // Set the values of the input fields
    $('#code2').val(clustercode);
    $('#material2').val(cluster_description);

    // Make the input fields read-only
    $('#code2').prop('readonly', true);
    $('#material2').prop('readonly', true);
    $('#code4').val(clustercode);
    $('#material4').val(cluster_description);

    // Make the input fields read-only
    $('#code4').prop('readonly', true);
    $('#material4').prop('readonly', true);

    // Show the modal
    modal2.style.display = "block";
}

function binCardModalFunction(clustercode, cluster_description) {
    // Filter the items based on the clustercode
    var items = $('.modal-table-part .table-row').filter(function() {
        return $(this).find('.table-cell2:first-child').text().trim() === clustercode;
    });

    // Hide all items
    $('.modal-table-part .table-row').hide();

    // Initialize a counter for totalAmount
    var totalAmount = 0;

    // Show only the items with the same clustercode and update their first cell with the counter
    items.each(function(index) {
        $(this).show();

        // Apply the colors dynamically
        if (index % 2 === 0) {
            $(this).find('.table-cell2').css('background-color', '#E1E1E1'); // odd rows
        } else {
            $(this).find('.table-cell2').css('background-color', 'white'); // even rows
        }

        // Add the price to totalAmount
        var price = parseFloat($(this).find('.table-cell2:nth-child(8)').text().replace('₱', ''));
        totalAmount += price;
    });

    // Set the values of the input fields
    $('#code3').val(clustercode);
    $('#material3').val(cluster_description);

    // Make the input fields read-only
    $('#code3').prop('readonly', true);
    $('#material3').prop('readonly', true);

    // Show the modal
    binCardModal.style.display = "block";

    // Display the totalAmount
    $('.below-upper-table-part .below-table-part-text2').text('TOTAL AMOUNT: ₱' + totalAmount);
}

// Functions to handle the discard and save buttons
function discardChanges() {
// Add your code here to discard changes
}

function saveChanges() {
// Add your code here to save changes
}

function myFunction() {
  // Declare variables
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById('myInput');
  filter = input.value.toUpperCase();
  table = document.getElementById("itemTable");
  tr = table.getElementsByTagName('tr');

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0]; // Get the first column (CODE)
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}

function myFunction2() {
  // Declare variables
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById('myInput2');
  filter = input.value.toUpperCase();
  table = document.getElementById("itemTable3");
  tr = table.getElementsByTagName('tr');

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0]; // Get the first column (CODE)
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}

function myFunction3() {
  // Declare variables
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById('myInput3');
  filter = input.value.toUpperCase();
  table = document.getElementById("itemTable4");
  tr = table.getElementsByTagName('tr');

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0]; // Get the first column (CODE)
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}

function myFunction4() {
  // Declare variables
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById('myInput4');
  filter = input.value.toUpperCase();
  table = document.getElementById("itemTable2");
  tr = table.getElementsByTagName('tr');

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0]; // Get the first column (CODE)
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}

function updateIcon(value) {
    var gearIcon = document.getElementById('cluster_cell');
    if (value === 'SET') {
      gearIcon.src = './assets/changinggear-1.png';
    } else if (value === 'DESET') {
      gearIcon.src = './assets/deset_icon.png';
    }
  }

    </script>

</body>
</html>