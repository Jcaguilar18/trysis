<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Inventory Final Report</title>
    <style>
      body {
        font-family: 'Arial', sans-serif;
        padding: 20px;
      }
      .report-title {
        text-align: center;
        margin-bottom: 20px;
      }
      .report-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      .report-table, .report-table th, .report-table td {
        border: 1px solid #ddd;
      }
      .report-table th, .report-table td {
        padding: 8px;
        text-align: left;
      }
      .report-table th {
        background-color: #f2f2f2;
      }
      .report-footer {
        text-align: center;
        margin-top: 40px;
        font-size: 0.9em;
      }
      .print-button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        text-align: center;
        display: inline-block;
        font-size: 16px;
        margin: 20px auto;
        display: block;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
</head>
<body>
  <div class="report-container" id="report">
    <div class="report-title">
      <h1>Inventory Final Report</h1>
      <% if (reportData && reportData.length > 0) { %>
        <p>Report Period: <%= new Date(reportData[0].item_date).toDateString() %></p>
      <% } else { %>
        <p>Report Period: Not available</p>
      <% } %>
    </div>

    <% [1, 2, 3].forEach(function(classificationId) { %>
      <% const classificationItems = reportData.filter(item => item.classification_id === classificationId); %>
      <% const classificationName = classificationId === 1 ? 'Fabrication' : classificationId === 2 ? 'Firepro' : 'Electrical'; %>
      <h2><%= classificationName %></h2>
      <div class="report-table">
        <table>
          <tr>
            <th>CODE</th>
            <th>DESCRIPTION</th>
            <th>PRICE</th>
            <th>TOTAL AMOUNT</th>
          </tr>
          <% classificationItems.forEach(function(item) { %>
            <tr>
              <td><%= item.clustercode %></td>
              <td><%= item.description %></td>
              <td>₱<%= item.price.toFixed(2) %></td>
              <td>₱<%= (item.available * item.price).toFixed(2) %></td>
            </tr>
          <% }); %>
        </table>
      </div>
    <% }); %>

    <div class="report-footer">
      Generated by: <%= currentUser %> - <%= currentRole %>
    </div>
  </div>

  <button type="button" class="print-button" onclick="downloadPDF();">Download PDF</button>

  <script>
    function downloadPDF() {
      if (typeof html2pdf === 'undefined') {
        console.error('html2pdf library is not loaded!');
        return;
      }

      var element = document.getElementById('report');
      var opt = {
        margin:       [1, 0.5],
        filename:     'InventoryFinalReport.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };

      html2pdf().set(opt).from(element).toPdf().get('pdf').then(function (pdfObj) {
        // You can use the pdfObj here if you need to perform further actions with the PDF
      }).save();
    }
  </script>
</body>
</html>
